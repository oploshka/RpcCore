server {

  server_name localhost;

  # суммарный размер отправляемых данных на серевер
  client_max_body_size 5m;

  root /var/www/html;
  listen 80;

  location ~* .(jpg|jpeg|gif|png|ico|css|bmp|swf|js|mov|avi|mp4|mpeg4|ttf|woff|woff2) {
    include  /etc/nginx/mime.types;
  }

  location ~ /.ht {
    deny all;
  }



  set $cors_max_age "";
  set $options_content_length "";
  set $options_content_type "";

  if ($request_method = 'OPTIONS') {
    set $cors_max_age  "1728000";
    set $options_content_length  "0";
    set $options_content_type  "text/plain charset=UTF-8";
  }

  add_header 'Access-Control-Max-Age' $cors_max_age;
  add_header 'Content-Type'   $options_content_type;
  add_header 'Content-Length' $options_content_length;

  add_header 'Access-Control-Allow-Origin' '*' always;
  add_header 'Access-Control-Allow-Credentials' 'true' always;
  add_header 'Access-Control-Allow-Methods' 'GET, PUT, POST, DELETE, PATCH, OPTIONS' always;
  add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,Vary' always;

  if ($request_method = 'OPTIONS') {
    return 204;
  }

  # php-fpm
  location / {
    try_files $uri $uri/ /index.php?$args;
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_pass rpc:9000;
    fastcgi_index index.php;
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_path_info;
  }

}
